

-- query untuk show model  purchase

-- SELECT *,jumlah_detail_penjualan,jumlah_detail_pembelian from transaksi 
--         join penawaran on penawaran.id_transaksi=transaksi.id_transaksi
--         join detail_transaksi_penawaran on detail_transaksi_penawaran.id_penawaran=penawaran.id_penawaran
--         join penjualan on penjualan.id_transaksi=transaksi.id_transaksi
--         join detail_transaksi_penjualan on penjualan.id_penjualan=detail_transaksi_penjualan.id_penjualan
--         left join pembelian on pembelian.id_penjualan=penjualan.id_penjualan
--         left join detail_transaksi_pembelian on detail_transaksi_pembelian.id_pembelian=pembelian.id_pembelian
--         join pelanggan on pelanggan.id_pelanggan=transaksi.id_pelanggan
--         join pengguna on pengguna.id=transaksi.id
--         join produk on detail_transaksi_penjualan.id_produk=produk.id_produk
--         group by penjualan.id_penjualan
--         having   jumlah_detail_penjualan> sum(ifnull(jumlah_detail_pembelian,0))



-- edit purchase model

select transaksi.id_transaksi,penjualan.id_penjualan,penjualan.tgl_penjualan,penjualan.no_penjualan
,detail_transaksi_penjualan.id_produk,detail_transaksi_penjualan.jumlah_detail_penjualan
,transaksi.harga,transaksi.berat,jumlah_detail_pembelian,
case 
when jumlah_detail_pembelian is not null then jumlah_detail_penjualan - jumlah_detail_pembelian
else jumlah_detail_penjualan
end as jumlah_unit
from transaksi 
join  penjualan on penjualan.id_transaksi=transaksi.id_transaksi
join detail_transaksi_penjualan on detail_transaksi_penjualan.id_penjualan = penjualan.id_penjualan
left join pembelian on pembelian.id_penjualan=penjualan.id_penjualan
left join detail_transaksi_pembelian on detail_transaksi_pembelian.id_pembelian=pembelian.id_pembelian
where kode_transaksi='PJ1'
group by id_penjualan
 having jumlah_detail_penjualan>sum(ifnull(jumlah_detail_pembelian,0))

-- query index model 




